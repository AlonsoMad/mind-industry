<!DOCTYPE html>
<html>
  <head>
    <title>Annotate Document</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .my_radio {
        margin-left: 20px;
      }
      .center-button,
      .center-buttons {
        display: flex;
        justify-content: center;
        margin-top: 10px;
      }
      .disabled-button {
        pointer-events: none;
        opacity: 0.6;
      }
      .question-container {
        padding-left: 20px; /* Adjust the value as needed */
      }
      
      .highlight_health {
        background-color: #9b9a34;
        color: black;
        font-weight: bold;
      }
      .definition_health {
          color: #9b9a34;
      }
      .highlight_kids {
          background-color: #329999;
          color: black;
          font-weight: bold;
      }
      .definition_kids {
          color: #329999;
      }
      .highlight_women {
          background-color: #329933;
          color: black;
          font-weight: bold;
      }
      .definition_women {
          color: #329933;
      }
      .highlight_ss {
          background-color: #fe32fc;
          color: black;
          font-weight: bold;
      }
      .definition_ss {
          color: #fe32fc;
      }
      .highlight_none {
          background-color: #808080;
          color: black;
          font-weight: bold;
      }
      .definition_none {
          color: #808080;
      }
    table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 20px;
      }
      th, td {
          padding: 10px;
          text-align: center;
          vertical-align: middle;
      }
      .table-striped tbody tr:nth-of-type(odd) {
          background-color: rgba(0, 0, 0, 0.05);
      }
      .table-bordered th, .table-bordered td {
          border: 1px solid #dee2e6;
      }
      .checkbox-group {
          display: flex;
          flex-direction: column;
          margin-bottom: 10px;
      }
      .checkbox-group label {
          margin-bottom: 5px;
      }
      .checkbox-group div {
          display: flex;
          align-items: center;
          gap: 10px;
      }
      .thead-custom {
          background-color: #024287ee;
          color: white;
      }
      .alert-heading {
          margin-top: 20px;
      }
      input[type="radio"] {
          appearance: none;
          background-color: #fff;
          border: 1px solid #ccc;
          width: 20px;
          height: 20px;
          border-radius: 50%;
          position: relative;
          cursor: pointer;
          outline: none;
      }
      input[type="radio"]:checked {
          background-color: #555;
          border-color: #555;
      }
      input[type="radio"]::before {
          content: '';
          display: block;
          width: 60%;
          height: 60%;
          border-radius: 50%;
          background-color: #fff;
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
      }
      input[type="radio"]:checked::before {
          background-color: #555;
      }

      .thead-custom {
        background-color: #024287ee; /* Bluish background color */
        color: white;
      }
      .instructions {
        display: none;
        margin-top: 20px; /* Adjust the value as needed */
      }
      .message {
        font-size: 24px; /* Tama√±o de fuente m√°s grande */
        font-weight: bold; /* Negrita */
        text-align: center; /* Centrado */
        margin-top: 20px; /* Espacio superior */
      }
      .text-danger {
          color: red; /* Color rojo para los errores */
      }
      .text-success {
          color: green; /* Color verde para el √©xito */
      }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $(document).ready(function () {
        // Function to fetch document count
        function fetchDocumentCount() {
          $.get("/get_document_count", function (data) {
            if (
              data.total_documents !== undefined &&
              data.remaining_documents !== undefined
            ) {
              $("#document_count").text(
                "Documents Left: " +
                  data.remaining_documents +
                  "/" +
                  data.total_documents
              );
            } else {
              $("#document_count")
                .text("Error fetching document count")
                .addClass("text-danger");
            }
          });
        }

        // Function to fetch a new document
        function fetchDocument() {
          $.post("/get_new_document", function (data) {
            console.log(data);
            if (data.error) {
              $("#message").text(data.error).addClass("text-danger");
              $("#annotation_form").hide();
            } else if (data.message) {
              $("#message").text(data.message).addClass("text-success");
              $("#main_content").hide();
              $("#document_count").hide();
              $("#completion_message").show();
            } else {
              $("#document").text(data.text);
              $("#doc_id").val(data.doc_id);
              const aux_idx = $("#doc_id").val();
              console.log("this is the idx");
              console.log(aux_idx);
              $("#message").text("");
              $("#annotation_form").show();

              // Clear all radio button selections
              $('#annotation_form input[type="radio"]').prop('checked', false);

              fetchDocumentCount(); // Update the document count after fetching a new document
            }
          });
        }

        // Function to submit annotation
        function submitAnnotation(label) {
          const idx = $("#doc_id").val();
          console.log("this is the idx");
          console.log(idx);
          $.post(
            "/submit_annotation",
            { label: label, idx: idx },
            function (response) {
              if (response.message) {
                $("#message")
                  .text(response.message)
                  .removeClass("text-danger")
                  .addClass("text-success");
                fetchDocument(); // Fetch a new document after successful annotation
              } else {
                $("#message")
                  .text(response.error)
                  .removeClass("text-success")
                  .addClass("text-danger");
              }
            }
          );
        }

        // Event listener for the annotate button
        document
          .getElementById("annotate_button")
          .addEventListener("click", function () {
            const annotations = [];
            let allSelected = true; // Variable to track if all options are selected

            // Function to check and push the value for each category
            function checkAndPush(name) {
              const selected = document.querySelector(
                `input[name="${name}"]:checked`
              );
              if (selected) {
                annotations.push(selected.value === "yes" ? 1 : 0);
              } else {
                allSelected = false; // Mark as false if any option is not selected
              }
            }

            // Check each category
            checkAndPush("health");
            checkAndPush("kids");
            checkAndPush("women");
            checkAndPush("services");

            // Show message and prevent submission if not all options are selected
            if (!allSelected) {
              alert("Please select an option for all categories.");
              return; // Prevent further execution
            }

            if (annotations.length === 0) {
              annotations.push(0); // None
            }
            // Convert annotations array to a string
            const annotationsString = annotations.join(',');

            console.log(annotationsString);
            submitAnnotation(annotationsString);
          });

        $("#show_instructions").on("click", function () {
          $(".instructions").toggle();
        });

        fetchDocument(); // Fetch the first document when the page loads
      });
    </script>
  </head>
  <body>
    <div class="container mt-5">
      <h1>Annotate Passage</h1>
      <div class="center-buttons">
        <button id="show_instructions" class="btn btn-secondary mb-3">
          Show Instructions
        </button>
      </div>
      <div class="alert alert-secondary" id="document_count">Loading document count...</div>
      <div id="main_content">
        <div class="card mb-3">
          <div class="card-body">
            <p id="document">Loading...</p>
            <input type="hidden" id="doc_id" value="">
          </div>
        </div>

      <div class="question-container" id="annotation_form" class="annotation-buttons mb-3">
        <div class="annotation-buttons mt-2">
          <label>Is this passage relevant for <b><span class="highlight_health">HEALTH</span></b>? ü©∫</label>
          <div>
            <input class="my_radio" type="radio" id="health_yes" name="health" value="yes" />
            <label for="health_yes">YES</label>
            <input class="my_radio" type="radio" id="health_no" name="health" value="no" />
            <label for="health_no">NO</label>
          </div>
        </div>
        <div class="annotation-buttons mt-2">
          <label>Is this passage relevant for <b><span class="highlight_kids">KIDS</span></b>? üßí</label>
          <div>
            <input class="my_radio" type="radio" id="kids_yes" name="kids" value="yes" />
            <label for="kids_yes">YES</label>
            <input class="my_radio" type="radio" id="kids_no" name="kids" value="no" />
            <label for="kids_no">NO</label>
          </div>
        </div>
        <div class="annotation-buttons mt-2">
          <label>Is this passage relevant for <b><span class="highlight_women">WOMEN</span></b>? üë©</label>
          <div>
            <input class="my_radio" type="radio" id="women_yes" name="women" value="yes" />
            <label for="women_yes">YES</label>
            <input class="my_radio" type="radio" id="women_no" name="women" value="no" />
            <label for="women_no">NO</label>
          </div>
        </div>
        <div class="annotation-buttons mt-2">
          <label>Is this passage relevant for <b><span class="highlight_ss">SOCIAL SERVICES</span></b>? üè¢</label>
          <div>
            <input class="my_radio" type="radio" id="services_yes" name="services" value="yes" />
            <label for="services_yes">YES</label>
            <input class="my_radio" type="radio" id="services_no" name="services" value="no" />
            <label for="services_no">NO</label>
          </div>
        </div>
      </div>

        <div class="center-button">
          <button class="btn btn-primary btn-lg btn-block" id="annotate_button">
            Annotate
          </button>
        </div>
        <div class="center-button">
          <p id="message" class="message mt-3"></p>
        </div>
      </div>
      <div id="completion_message" style="display: none; text-align: center; margin-top: 20px;">
        <h2 style='color: green; font-weight: bold;'>No more documents to label. Task completed.</h2>
        <h3 style='color: gray;'>Thank you for your participation!  &#128522;</h3>
    </div>
        <div class="instructions alert alert-info" style="display: none">
          <h1 class="mb-4">Instructions for Evaluating Rosie Corpus Documents</h1>
          <div class="alert alert-info">
              <strong>Welcome to the Rosie Corpus Documents evaluation task. Please follow the steps below:</strong>
          </div>
        
          <h2>üìñ Task Orientation</h2>
          <p>
              You are going to be evaluating document passages from the Rosie Corpus. Your task is to review each passage and annotate whether it is relevant for each of the following domains:
              <b><span class="highlight highlight_health">HEALTH</span>, <span class="highlight highlight_kids">KIDS</span>, <span class="highlight highlight_women">WOMEN</span>, <span class="highlight highlight_ss">SOCIAL SERVICES</span>.</b> You may encounter passages that do not fit into any of the specified categories, in which case you should not select any category.
          </p>
          
          <div class="mt-4">
              <div>
                  <span class="highlight highlight_health">Health</span>
              </div>
              <div>
                  <span class="definition_health">Definition:</span> Text that refers to aspects related to physical and mental well-being. Examples: medical care, disease prevention, wellness programs, healthcare services, etc.
              </div>
              <div>
                  <span class="definition_health">Text example:</span> <em>‚ÄúTreatment options for germ cell tumors may include surgery to remove the tumor, chemotherapy with drugs that kill cancer cells, and radiation therapy with powerful energy beams.‚Äù</em>
              </div>
          </div>
          
          <div class="mt-4">
              <div>
                  <span class="highlight highlight_kids">Kids</span>
              </div>
              <div>
                  <span class="definition_kids">Definition:</span> Text that focuses on issues, programs, or services specifically related to children, such as education, child development, childcare, and pediatric care.
              </div>
              <div>
                  <span class="definition_kids">Text example:</span> <em>Astraphobia is the extreme fear of thunder and lightning. It‚Äôs most common in children‚Ä¶</em>
              </div>
          </div>
          
          <div class="mt-4">
              <div>
                  <span class="highlight highlight_women">Women</span>
              </div>
              <div>
                  <span class="definition_women">Definition:</span> Texts that address the health, rights, and well-being of women, including reproductive health, gender-specific healthcare, etc.
              </div>
              <div>
                  <span class="definition_women">Text example:</span> <em>‚ÄúBecause the seroconversion rate after vaccination of pregnant women might be markedly reduced compared with that of other healthy women, serologic tests to determine if a specific yellow fever immune response exists should be considered‚Ä¶‚Äù</em>
              </div>
          </div>
          
          <div class="mt-4">
              <div>
                  <span class="highlight highlight_ss">Social Services</span>
              </div>
              <div>
                  <span class="definition_ss">Definition:</span> Text that refers to aspects related to physical and mental well-being. Examples: medical care, disease prevention, wellness programs, healthcare services, etc.
              </div>
              <div>
                  <span class="definition_ss">Text example:</span> <em>‚ÄúThe grants, available in fiscal year 2023 and supported and administered by NIOSH, will provide funding to qualified individuals in academia, members of non-profit organizations, municipalities, and businesses involved in the fishing and maritime industries‚Ä¶‚Äù</em>
              </div>
          </div>
  
          <br>
  
          <h2>‚úîÔ∏è Steps to Follow</h2>
          <ol>
              <li><strong>Review the passage</strong></li>
              <li>
                  <strong>Provide annotations by checking the corresponding boxes:</strong>
                  <div class="annotation-buttons mt-2">
                      <div class="checkbox-group">
                          <label>Is this passage relevant for <b><span class="highlight_health">HEALTH</span></b>? ü©∫</label>
                          <div>
                              <input class="my_radio" type="radio" id="health_yes" name="health" disabled value="yes"/>
                              <label for="health_yes">YES</label>
                              <input class="my_radio" type="radio" id="health_no" name="health" disabled value="no"/>
                              <label for="health_no">NO</label>
                          </div>
                      </div>
                      <div class="checkbox-group">
                          <label>Is this passage relevant for <b><span class="highlight_kids">KIDS</span></b>? üßí</label>
                          <div>
                              <input class="my_radio" type="radio" id="kids_yes" name="kids" disabled value="yes"/>
                              <label for="kids_yes">YES</label>
                              <input class="my_radio" type="radio" id="kids_no" name="kids" disabled value="no"/>
                              <label for="kids_no">NO</label>
                          </div>
                      </div>
                      <div class="checkbox-group">
                          <label>Is this passage relevant for <b><span class="highlight_women">WOMEN</span></b>? üë©</label>
                          <div>
                              <input class="my_radio" type="radio" id="women_yes" name="women" disabled value="yes"/>
                              <label for="women_yes">YES</label>
                              <input class="my_radio" type="radio" id="women_no" name="women" disabled value="no"/>
                              <label for="women_no">NO</label>
                          </div>
                      </div>
                      <div class="checkbox-group">
                          <label>Is this passage relevant for <b><span class="highlight_ss">SOCIAL SERVICES</span></b>? üè¢</label>
                          <div>
                              <input class="my_radio" type="radio" id="services_yes" name="services" disabled value="yes"/>
                              <label for="services_yes">YES</label>
                              <input class="my_radio" type="radio" id="services_no" name="services" disabled value="no"/>
                              <label for="services_no">NO</label>
                          </div>
                      </div>
                  </div>
              </li>
              <li>Wait for the message <strong style="color:green;">"Document labeled successfully"</strong> before moving to the next document.</li>
              <li>Once the active learning loop is completed, a <strong>completion message</strong> will be displayed in large, <strong style="color:green;">green font</strong>.
              </li>
              <li>You can <strong>toggle the button below</strong> to view some <strong>example annotations</strong>.
              </li>
          </ol>
          <div class="center-buttons">
              <button class="btn btn-secondary" type="button" data-toggle="collapse" data-target="#exampleAnnotations" aria-expanded="false" aria-controls="exampleAnnotations">
                  Toggle Example Annotations
              </button>
          </div>
          <div id="exampleAnnotations" class="collapse">
              <table class="table table-bordered table-striped">
                  <thead class="thead-custom">
                      <tr>
                          <th>Document</th>
                          <th>HEALTH</th>
                          <th>KIDS</th>
                          <th>WOMEN</th>
                          <th>SOCIAL SERVICES</th>
                      </tr>
                  </thead>
                  <tbody>
                      <tr>
                          <td>Despite that, most babies get diaper rash at some point‚Ä¶.</td>
                          <td><input class="my_radio" type="radio" name="doc4_health" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc4_kids" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc4_women" disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc4_services" disabled/></td>
                      </tr>
                      <tr>
                          <td>Because the seroconversion rate after vaccination of pregnant women might be markedly reduced compared with that of other healthy women, serologic tests to determine if a specific yellow fever immune response exists should be considered‚Ä¶.</td>
                          <td><input class="my_radio" type="radio" name="doc5_health" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc5_kids" disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc5_women" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc5_services" disabled/></td>
                      </tr>
                      <tr>
                          <td>Mayo Clinic's medical rehabilitation expertise will be integrated with MN BIA Resource Facilitation services to connect individuals with TBI to community resources‚Ä¶</td>
                          <td><input class="my_radio" type="radio" name="doc6_health" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc6_kids" disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc6_women" disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc6_services" checked disabled/></td>
                      </tr>
                      <tr>
                          <td>Children who were treated with antibiotics also experienced nearly four fewer ‚Äúsick days‚Äù at home on average than those who underwent surgery. Their caregivers required less of this time as well‚Ä¶</td>
                          <td><input class="my_radio" type="radio" name="doc7_health" disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc7_kids" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc7_women" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc7_services" disabled/></td>
                      </tr>
                      <tr>
                          <td>Watch the Meaningful Renewal team work with family child care providers to provide safe learning environments for different age groups. Create environments that promote children's social and emotional development...</td>
                          <td><input class="my_radio" type="radio" name="doc8_health" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc8_kids" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc8_women" disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc8_services" checked disabled/></td>
                      </tr>
                      <tr>
                          <td>Women are the fastest growing group of female military veterans in the United States and have specific health care needs. And women veterans are taking steps to fully address those needs‚Ä¶</td>
                          <td><input class="my_radio" type="radio" name="doc9_health" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc9_kids" disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc9_women" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc9_services" checked disabled/></td>
                      </tr>
                      <tr>
                          <td>Continue to foster the learning process by engaging, responding, and encouraging exploration. Practice and build on what your little one learns with age-appropriate toys and a safe environment to explore‚Ä¶</td>
                          <td><input class="my_radio" type="radio" name="doc10_health" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc10_kids" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc10_women" disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc10_services" disabled/></td>
                      </tr>
                      <tr>
                          <td>Each person's journey through postpartum depression (PPD) is specific to each person, but there are many ways to get help. The first step towards healing is to seek support. Listen to Clarissa tell how she found support to help her heal at www.womenshealth.gov/talkingPPD....</td>
                          <td><input class="my_radio" type="radio" name="doc11_health" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc11_kids" disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc11_women" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc11_services" checked disabled/></td>
                      </tr>
                      <tr>
                          <td>Dual Language Learners: Program and Family Support In this module, explore the four components of effective program and family support for dual language learners‚Ä¶</td>
                          <td><input class="my_radio" type="radio" name="doc12_health" disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc12_kids" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc12_women" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc12_services" checked disabled/></td>
                      </tr>
                      <tr>
                          <td>The technique involves sexually stimulating the man until he recognizes that he is about to ejaculate‚Ä¶‚Ä¶</td>
                          <td><input class="my_radio" type="radio" name="doc12_health" disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc12_kids"  disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc12_women"  disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc12_services"  disabled/></td>
                      </tr>
                  </tbody>
              </table>
          </div>

          <div class="alert alert-warning alert-heading">
              <strong>Important!</strong> If you are unsure about whether the document is relevant for a certain category, please select it as <strong>RELEVANT</strong> to avoid missing any relevant documents.
          </div>
        </div>
      </div>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  </body>
</html>
